<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Propelize - Connexion</title>
  <style>
    /* Votre CSS existant reste inchangÃ© */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: linear-gradient(135deg, #4361ee, #4cc9f0);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
      font-family: 'Roboto', sans-serif;
      color: white;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .bubbles {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 0;
      overflow: hidden;
      top: 0;
      left: 0;
    }
    
    .bubble {
      position: absolute;
      bottom: -100px;
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      animation: rise 10s infinite ease-in;
    }
    
    @keyframes rise {
      0% {
        bottom: -100px;
        transform: translateX(0);
      }
      50% {
        transform: translateX(100px);
      }
      100% {
        bottom: 1080px;
        transform: translateX(-200px);
      }
    }
    
    .container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 3rem;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      max-width: 500px;
      width: 90%;
      z-index: 1;
      animation: fadeIn 1s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* ... Le reste de votre CSS ... */
  </style>
</head>
<body>
<div class="bubbles">
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
</div>

<div class="container login-container" id="loginContainer">
    <h1>Propelize</h1>
    <p class="subtitle">Plateforme de gestion de vÃ©hicules premium</p>
    
    <form class="login-form" id="loginForm">
      <div class="input-group">
        <label for="username">Nom d'utilisateur</label>
        <div class="icon">ğŸ‘¤</div>
        <input type="text" id="username" name="username" placeholder="Votre nom d'utilisateur" required>
      </div>
      
      <div class="input-group">
        <label for="password">Mot de passe</label>
        <div class="icon">ğŸ”’</div>
        <input type="password" id="password" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
      </div>
      
      <div class="input-group">
        <label for="role">Vous Ãªtes:</label>
        <div class="role-icon">ğŸ‘‘</div>
        <select id="role" name="role" required>
          <option value="">SÃ©lectionnez votre rÃ´le</option>
          <option value="admin">Administrateur</option>
          <option value="user">Utilisateur</option>
        </select>
      </div>
      
      <div class="remember-forgot">
        <div class="remember">
          <input type="checkbox" id="remember">
          <label for="remember">Se souvenir de moi</label>
        </div>
        <a href="#" class="forgot-password">Mot de passe oubliÃ©?</a>
      </div>
      
      <div class="error-message" id="loginError"></div>
      
      <button type="submit" class="btn-login">Se connecter</button>
    </form>
    
    <p class="signup-link">Pas encore inscrit? <a href="#" id="showSignup">CrÃ©er un compte</a></p>
</div>

<div class="container signup-container" id="signupContainer">
    <button class="back-btn" id="backToLogin">â† Retour</button>
    <h1>CrÃ©er un compte</h1>
    <p class="subtitle">Rejoignez notre plateforme premium</p>
    
    <form class="signup-form" id="signupForm">
      <div class="input-group">
        <label for="fullname">Nom complet</label>
        <div class="icon">ğŸ‘¤</div>
        <input type="text" id="fullname" name="fullname" placeholder="Votre nom complet" required>
      </div>
      
      <div class="input-group">
        <label for="username">Nom d'utilisateur</label>
        <div class="icon">ğŸ‘¤</div>
        <input type="text" id="signup-username" name="username" placeholder="Choisissez un nom d'utilisateur" required>
      </div>
      
      <div class="input-group">
        <label for="signup-password">Mot de passe</label>
        <div class="icon">ğŸ”’</div>
        <input type="password" id="signup-password" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
      </div>
      
      <div class="input-group">
        <label for="confirm-password">Confirmer le mot de passe</label>
        <div class="icon">ğŸ”’</div>
        <input type="password" id="confirm-password" name="confirm-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
      </div>
      
      <div class="remember">
        <input type="checkbox" id="terms" required>
        <label for="terms">J'accepte les <a href="#" style="color: white; text-decoration: underline;">termes et conditions</a></label>
      </div>
      
      <div class="error-message" id="signupError"></div>
      
      <button type="submit" class="btn-signup">S'inscrire</button>
    </form>
    
    <p class="login-link">DÃ©jÃ  inscrit? <a href="#" id="showLogin">Se connecter</a></p>
</div>

<script>
    // RÃ©cupÃ©ration des Ã©lÃ©ments
    const loginContainer = document.getElementById('loginContainer');
    const signupContainer = document.getElementById('signupContainer');
    const showSignupLink = document.getElementById('showSignup');
    const showLoginLink = document.getElementById('showLogin');
    const backToLoginBtn = document.getElementById('backToLogin');
    const loginError = document.getElementById('loginError');
    const signupError = document.getElementById('signupError');
    
    // Gestion de l'affichage des formulaires
    showSignupLink.addEventListener('click', function(e) {
      e.preventDefault();
      loginContainer.style.display = 'none';
      signupContainer.style.display = 'block';
      signupError.style.display = 'none';
    });
    
    showLoginLink.addEventListener('click', function(e) {
      e.preventDefault();
      signupContainer.style.display = 'none';
      loginContainer.style.display = 'block';
      loginError.style.display = 'none';
    });
    
    backToLoginBtn.addEventListener('click', function(e) {
      e.preventDefault();
      signupContainer.style.display = 'none';
      loginContainer.style.display = 'block';
      loginError.style.display = 'none';
    });
    
    // Fonction pour afficher les erreurs
    function showError(element, message) {
      element.textContent = message;
      element.style.display = 'block';
    }
    
    // Fonction pour envoyer les requÃªtes API - CORRECTION: Ajout de async
    async function sendRequest(url, method, data) {
      try {
        const token = localStorage.getItem('authToken');
        const headers = {
          'Content-Type': 'application/json'
        };
        
        // Ajouter le token d'authentification s'il existe
        if (token) {
          headers['Authorization'] = `Bearer ${token}`;
        }
        
        const response = await fetch(url, {
          method: method,
          headers: headers,
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (!response.ok) {
          throw new Error(result.message || 'Erreur serveur');
        }
        
        return result;
      } catch (error) {
        throw error;
      }
    }
    
    // CORRECTION: Ajout de async Ã  la fonction de gestion de soumission
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // RÃ©cupÃ©rer les valeurs des champs
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const role = document.getElementById('role').value;
      
      // Validation basique
      if (!username || !password || !role) {
        showError(loginError, 'Veuillez remplir tous les champs');
        return;
      }
      
      // Animation de chargement
      const btn = document.querySelector('.btn-login');
      btn.innerHTML = 'Connexion en cours...';
      btn.disabled = true;
      loginError.style.display = 'none';
      
      try {
        // Envoyer les donnÃ©es au backend
        const response = await sendRequest('/api/login', 'POST', {
          username: username,
          password: password,
          role: role
        });
        
        // Stocker le token dans localStorage
        localStorage.setItem('authToken', response.token);
        localStorage.setItem('currentUser', JSON.stringify({
          username: username,
          role: role
        }));
        
        // Redirection basÃ©e sur le rÃ´le
        if (role === 'admin') {
          window.location.href = '/dashboard-admin';
        } else {
          window.location.href = '/dashboard-user';
        }
        
      } catch (error) {
        showError(loginError, error.message);
      } finally {
        // RÃ©initialiser le bouton
        btn.innerHTML = 'Se connecter';
        btn.disabled = false;
      }
    });
    
    // CORRECTION: Ajout de async Ã  la fonction de gestion d'inscription
    document.getElementById('signupForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // RÃ©cupÃ©rer les valeurs des champs
      const fullname = document.getElementById('fullname').value;
      const username = document.getElementById('signup-username').value;
      const password = document.getElementById('signup-password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      
      // Validation basique
      if (!fullname || !username || !password || !confirmPassword) {
        showError(signupError, 'Veuillez remplir tous les champs');
        return;
      }
      
      if (password !== confirmPassword) {
        showError(signupError, 'Les mots de passe ne correspondent pas');
        return;
      }
      
      if (!document.getElementById('terms').checked) {
        showError(signupError, 'Veuillez accepter les termes et conditions');
        return;
      }
      
      // Animation de chargement
      const btn = document.querySelector('.btn-signup');
      btn.innerHTML = 'Inscription en cours...';
      btn.disabled = true;
      signupError.style.display = 'none';
      
      try {
        // Envoyer les donnÃ©es au backend
        const response = await sendRequest('/api/signup', 'POST', {
          fullname: fullname,
          username: username,
          password: password
        });
        
        // Afficher le succÃ¨s
        alert(response.message);
        
        // Retour Ã  la page de connexion
        signupContainer.style.display = 'none';
        loginContainer.style.display = 'block';
        
      } catch (error) {
        showError(signupError, error.message);
      } finally {
        // RÃ©initialiser le bouton
        btn.innerHTML = 'S\'inscrire';
        btn.disabled = false;
      }
    });
    
    // Effet de bulles animÃ©es
    document.querySelectorAll('.bubble').forEach(bubble => {
      bubble.style.left = Math.random() * 100 + '%';
    });
</script>
</body>
</html>
